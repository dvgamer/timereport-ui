{"version":3,"sources":["webpack:///webpack/bootstrap acc90d81d7306190652e","webpack:///external \"express\"","webpack:///./index.js","webpack:///./api/index.js","webpack:///external \"consola\"","webpack:///external \"http\"","webpack:///external \"socket.io\"","webpack:///external \"mssql\"","webpack:///./api/config-prod.js","webpack:///./api/inbound-transfer/index.js","webpack:///./api/inbound-transfer/query.js"],"names":["api","require","port","handler","listen","console","log","app","consola","http","Server","io","sql","prod","inboundTransder","query","use","on","socket","info","poolMain","pool","connect","taskGraph","results","request","graph","emit","setTimeout","taskQueue","queue","taskStatus","status","wait","nTotal","fail","complete","module","exports","path","user","password","server","database","options","encrypt","Router","router","get","req","res","json","error"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap acc90d81d7306190652e","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 0\n// module chunks = 0","const api = require('./api')\r\nconst port = 3001\r\napi.handler.listen(port, () => console.log(` READY  Listening on http://localhost:${port}`))\r\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","const app = require('express')()\r\nconst consola = require('consola')\r\nconst http = require('http').Server(app)\r\nconst io = require('socket.io')(http)\r\n\r\nconst sql = require('mssql')\r\nconst prod = require('./config-prod.js')\r\n\r\n// Require API routes\r\nconst inboundTransder = require('./inbound-transfer')\r\nconst query = require('./inbound-transfer/query')\r\n\r\n// Import API Routes\r\napp.use(inboundTransder)\r\n\r\n// sql.close()\r\nhttp.listen(5000, () => {\r\n\r\n  io.on('connection', socket => {\r\n    consola.info('socket.io user connected')\r\n    socket.on('disconnect', () => {\r\n      consola.info('socket.io user disconnected')\r\n    })\r\n  })\r\n\r\n  // setInterval(() => {\r\n  //   io.emit('inbound-realtime-graph', [])\r\n  //   io.emit('inbound-realtime-queue', [])\r\n  //   io.emit('inbound-realtime-status', { wait: 0, fail: 0, complete: 0 })\r\n  // }, 1000)\r\n\r\n  let poolMain = async () => {\r\n    let pool = await sql.connect(prod)\r\n  \r\n    let taskGraph = async () => {\r\n      let results = await pool.request().query(query.graph)\r\n      io.emit('inbound-realtime-graph', results['recordsets'][0])\r\n      setTimeout(taskGraph, 1000)\r\n    }\r\n  \r\n    let taskQueue = async () => {\r\n      let results = await pool.request().query(query.queue)\r\n      io.emit('inbound-realtime-queue', results['recordsets'][0])\r\n      setTimeout(taskQueue, 500)\r\n    }\r\n  \r\n    let taskStatus = async () => {\r\n      let results = await pool.request().query(query.status)\r\n      io.emit('inbound-realtime-status', {\r\n        wait: results['recordset'][0].nTotal,\r\n        fail: results['recordset'][1].nTotal,\r\n        complete: results['recordset'][2].nTotal\r\n      })\r\n      setTimeout(taskStatus, 1000)\r\n    }\r\n    taskGraph()\r\n    taskQueue()\r\n    taskStatus()\r\n  }\r\n  // poolMain()\r\n})\r\n\r\n// let exitHandler = (options, err) => {\r\n//   sql.close()\r\n//   consola.error('Processing Stoped.')\r\n//   if (options.exit) process.exit();\r\n// }\r\n\r\n// //catches ctrl+c event\r\n// process.on('SIGINT', exitHandler.bind(null, { exit: true }))\r\n\r\n// // catches \"kill pid\" (for example: nodemon restart)\r\n// process.on('SIGUSR1', exitHandler.bind(null, { exit: true }))\r\n// process.on('SIGUSR2', exitHandler.bind(null, { exit: true }))\r\n// process.on('uncaughtException', exitHandler.bind(null, { exit: true }))\r\n\r\n// Export the server middleware\r\nmodule.exports = {\r\n  path: '/api',\r\n  handler: app\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./api/index.js","module.exports = require(\"consola\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"consola\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"socket.io\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"socket.io\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"mssql\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mssql\"\n// module id = 6\n// module chunks = 0","module.exports = {\r\n  user: 'posappadm',\r\n  password: 'qwerty8*',\r\n  server: '10.101.147.46\\\\poscmg',\r\n  database: 'POSGW',\r\n  options: {\r\n    encrypt: true\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./api/config-prod.js","const { Router } = require('express')\r\nconst router = Router()\r\n\r\n/* GET users listing. */\r\nrouter.get('/inbound-transfer/status', (req, res) => {\r\n  // dataStatus().then(data => {\r\n  //   res.json(data)\r\n  // }).catch(ex => {\r\n    res.json({ error: '' })\r\n  // })\r\n})\r\n\r\n// /* GET user by ID. */\r\n// router.get('/inbound-transfer/:id', function (req, res, next) {\r\n//   const id = parseInt(req.params.id)\r\n//   if (id >= 0 && id < users.length) {\r\n//     res.json(users[id])\r\n//   } else {\r\n//     res.sendStatus(404)\r\n//   }\r\n// })\r\n\r\nmodule.exports = router\r\n\n\n\n// WEBPACK FOOTER //\n// ./api/inbound-transfer/index.js","module.exports = {\r\n  status: `\r\n    SELECT COUNT(*) nTotal FROM POSGW..TFileTransUp a WITH(NOLOCK)\r\n      WHERE a.sStatus IN (3,5)\r\n    UNION ALL SELECT COUNT(*) FROM POSGW..TFileTransUp a WITH(NOLOCK)\r\n    WHERE a.sStatus IN (4,6) AND\r\n      CONVERT(DATETIME,STUFF(STUFF(CONVERT(VARCHAR(8), nStartDate),5,0,'-'),8,0,'-')+' '+STUFF(STUFF(LEFT(RIGHT('000000' + CONVERT(VARCHAR(6), nStartTime), 6),6),3,0,':'),6,0,':'),120)\r\n      >= CONVERT(DATE, DATEADD(DAY, -7, GETDATE()))\r\n    UNION ALL SELECT COUNT(*) FROM POSGW..TFileTransUp a WITH(NOLOCK)\r\n    WHERE a.sStatus = 0 AND\r\n      CONVERT(DATETIME,STUFF(STUFF(CONVERT(VARCHAR(8), nStartDate),5,0,'-'),8,0,'-')+' '+STUFF(STUFF(LEFT(RIGHT('000000' + CONVERT(VARCHAR(6), nStartTime), 6),6),3,0,':'),6,0,':'),120)\r\n      >= CONVERT(DATE, GETDATE())\r\n  `,\r\n  queue: `\r\n    SELECT 'SaleT1CAccum' sTable, COUNT(1) nTotal FROM POSGW..TFileTransUp a WITH(NOLOCK)\r\n    WHERE a.sStatus IN (3,5) AND (sZIPFileName LIKE 'SaleT1CAccum%')\r\n    UNION ALL SELECT 'ActualSale', COUNT(*) FROM POSGW..TFileTransUp a WITH(NOLOCK)\r\n    WHERE a.sStatus IN (3,5) AND (sZIPFileName LIKE 'ActualSale%')\r\n    UNION ALL SELECT 'T1CSaleMember', COUNT(*) FROM POSGW..TFileTransUp a WITH(NOLOCK)\r\n    WHERE a.sStatus IN (3,5) AND (sZIPFileName LIKE 'T1CSaleMember%')\r\n    UNION ALL SELECT 'Daily', COUNT(1) FROM POSGW..TFileTransUp a WITH(NOLOCK)\r\n    WHERE a.sStatus IN (3,5) AND (sZIPFileName LIKE 'Daily%')\r\n    UNION ALL SELECT 'FullInvoice', COUNT(1) FROM POSGW..TFileTransUp a WITH(NOLOCK)\r\n    WHERE a.sStatus IN (3,5) AND (sZIPFileName LIKE 'FullInvoice%')\r\n    UNION ALL SELECT 'StaffPurchase', COUNT(1) FROM POSGW..TFileTransUp a WITH(NOLOCK)\r\n    WHERE a.sStatus IN (3,5) AND (sZIPFileName LIKE 'StaffPurchase%')\r\n    UNION ALL SELECT 'Number', COUNT(1) FROM POSGW..TFileTransUp a WITH(NOLOCK)\r\n    WHERE a.sStatus IN (3,5) AND (sZIPFileName LIKE 'Number%')\r\n    UNION ALL SELECT 'Time', COUNT(1) FROM POSGW..TFileTransUp a WITH(NOLOCK)\r\n    WHERE a.sStatus IN (3,5) AND (sZIPFileName LIKE 'Time%')\r\n    UNION ALL SELECT 'Others', COUNT(1) FROM POSGW..TFileTransUp a WITH(NOLOCK)\r\n    WHERE a.sStatus IN (3,5) AND (sZIPFileName NOT LIKE 'SaleT1CAccum%' AND sZIPFileName NOT LIKE 'ActualSale%'\r\n    AND sZIPFileName NOT LIKE 'T1CSaleMember%' AND sZIPFileName NOT LIKE 'Daily%' AND sZIPFileName NOT LIKE 'FullInvoice%'\r\n    AND sZIPFileName NOT LIKE 'StaffPurchase%' AND sZIPFileName NOT LIKE 'Number%' AND sZIPFileName NOT LIKE 'Time%')\r\n  `,\r\n  graph: `\r\n    SELECT STUFF(STUFF(CONVERT(VARCHAR(8), nStartDate),5,0,'-'),8,0,'-')+' '+CONVERT(VARCHAR(5),STUFF(LEFT(RIGHT('000000' + CONVERT(VARCHAR(6), nStartTime), 6),6),3,0,':'))\r\n    , COUNT(*) aa\r\n    FROM POSGW..TDFileTransUp WITH(NOLOCK) \r\n    WHERE sStatus = 0 AND CONVERT(DATETIME,STUFF(STUFF(CONVERT(VARCHAR(8), nStartDate),5,0,'-'),8,0,'-')+' '+CONVERT(VARCHAR(5),STUFF(LEFT(RIGHT('000000' + CONVERT(VARCHAR(6), nStartTime), 6),6),3,0,':')),120) > \r\n      DATEADD(HOUR, -24, GETDATE())\r\n    GROUP BY nStartDate, CONVERT(VARCHAR(5),STUFF(LEFT(RIGHT('000000' + CONVERT(VARCHAR(6), nStartTime), 6),6),3,0,':'))\r\n    ORDER BY nStartDate, CONVERT(VARCHAR(5),STUFF(LEFT(RIGHT('000000' + CONVERT(VARCHAR(6), nStartTime), 6),6),3,0,':'))\r\n  `\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./api/inbound-transfer/query.js"],"sourceRoot":""}